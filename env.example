# Backend configuration
PORT=8080

# Redis (self-hosted)
# For Docker Compose, the backend service can reach Redis at host "redis"
REDIS_URL=redis://redis:6379
ENABLE_WS_PUBSUB=1

# Stateless agent auth (set a strong, non-empty secret in production)
# Required to keep login working across multiple Cloud Run instances
AGENT_AUTH_SECRET=change-me-please

# Optional: bootstrap an initial admin agent if the agents table is empty.
# Useful for fresh deployments to avoid a chicken-and-egg where creating agents requires an admin login.
# BOOTSTRAP_ADMIN_USERNAME=admin
# BOOTSTRAP_ADMIN_PASSWORD=change-me
# BOOTSTRAP_ADMIN_NAME=Administrator

# Optional rate limits (per-minute)
SEND_TEXT_PER_MIN=30
SEND_MEDIA_PER_MIN=15

# Database
# Default is SQLite stored at data/whatsapp_messages.db
# DB_PATH=data/whatsapp_messages.db
# SQLite lock wait (ms) to keep requests from hanging under contention
# SQLITE_BUSY_TIMEOUT_MS=3000
# Hard timeout (seconds) for auth DB operations (prevents upstream 504s on slow DB)
# AUTH_DB_TIMEOUT_SECONDS=8
# /health DB check timeout (seconds)
# HEALTH_DB_TIMEOUT_SECONDS=2
# DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/dbname

# WhatsApp / Catalog
# Required for sending/receiving via the Graph API
# Set your production values here (or in your deployment environment)
# WHATSAPP_ACCESS_TOKEN=...
WHATSAPP_PHONE_NUMBER_ID=639720275894706
# Optionally enforce filtering to a single phone number id (recommended)
# ALLOWED_PHONE_NUMBER_ID=639720275894706
# Optional: enable webhook signature verification and token validation
# META_APP_ID=...
# META_APP_SECRET=...
# CATALOG_ID=...
# Enable auto-reply with best-matching product image (0/1)
AUTO_REPLY_CATALOG_MATCH=1
# Minimum score (0.0-1.0) required to auto-reply
# AUTO_REPLY_MIN_SCORE=0.6
# Optional: limit auto-replies only to these phone numbers (comma-separated)
# Use WhatsApp IDs (digits only). Leave empty to allow all.
# Example: AUTO_REPLY_TEST_NUMBERS=212612345678,212698765432
# AUTO_REPLY_TEST_NUMBERS=

# Frontend-only: support contact phone shown in post-invoice message
# Example: +212612345678
REACT_APP_SUPPORT_PHONE=

# Survey testing (shorten delay and ignore invoice for specific numbers)
# Comma-separated WhatsApp IDs (digits only)
# Example: SURVEY_TEST_NUMBERS=212618182056
# SURVEY_TEST_NUMBERS=
# When set (>0), overrides the 4-hour wait. Example: 120 for 2 minutes.
# SURVEY_TEST_DELAY_SEC=0
# Ignore invoice presence check for test numbers (0/1)
# SURVEY_TEST_IGNORE_INVOICE=0
# Bypass 30-day cooldown for test numbers (0/1)
# SURVEY_TEST_BYPASS_COOLDOWN=0
# If not bypassing, shorten cooldown window (seconds). Example: 60
# SURVEY_TEST_COOLDOWN_SEC=60

# Google Cloud Storage
# GCS_BUCKET_NAME=...
# Optional: dedicate a second bucket only for user-uploaded media
# GCS_MEDIA_BUCKET_NAME=...
# GCS_CREDENTIALS_FILE=/app/credentials.json
# or
# GCS_CREDENTIALS_JSON={...}
# When set to 0, uploads remain private and are served via signed URLs
# GCS_PUBLIC_UPLOADS=1

# CORS for direct GCS access (configure on the bucket):
# Allow methods: GET, HEAD
# Allow headers: Range
# Expose headers: Accept-Ranges, Content-Range, Content-Length, Content-Type, ETag, Last-Modified

# Shopify (pick one set)
# SHOPIFY_API_KEY=...
# SHOPIFY_PASSWORD=...
# SHOPIFY_STORE_URL=https://example.myshopify.com
