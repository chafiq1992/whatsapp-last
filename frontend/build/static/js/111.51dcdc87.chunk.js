"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[111],{111:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var n=a(555),s=a(43),r=a(184),i=a(674),d=a(415),l=a(239),o=a.n(l),c=a(579);function u(e){var t;let{activeUser:a}=e;const l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE||"",[u,p]=(0,s.useState)(null),[m,h]=(0,s.useState)([]),[x,v]=(0,s.useState)(null),[g,b]=(0,s.useState)(0),[y,f]=(0,s.useState)(!1),[j,N]=(0,s.useState)([]),[w,_]=(0,s.useState)(!0),[k,A]=(0,s.useState)(!1),[C,S]=(0,s.useState)({name:"",email:"",phone:"",address:"",city:"",province:"",zip:"",order_note:"",order_image_url:"",complete_now:!1}),[z,D]=(0,s.useState)(""),[M,P]=(0,s.useState)([]),[E,O]=(0,s.useState)(""),[T,I]=(0,s.useState)([]),[q,F]=(0,s.useState)([]),[R,L]=(0,s.useState)(""),[U,W]=(0,s.useState)("due_on_receipt"),[H]=(0,s.useState)("Moroccan market"),[V,B]=(0,s.useState)(!1),[K,Y]=(0,s.useState)(""),[Z,G]=(0,s.useState)(null),[Q,J]=(0,s.useState)(""),[X,$]=(0,s.useState)([]),[ee,te]=(0,s.useState)(!1),[ae,ne]=(0,s.useState)(!0);(0,s.useEffect)((()=>{i.A.get("".concat(l,"/shopify-shipping-options")).then((e=>{F(e.data),e.data.length&&L(e.data[0].name)})).catch((()=>F([])))}),[l]),(0,s.useEffect)((()=>{if(null===a||void 0===a||!a.phone)return p(null),h([]),v(null),b(0),void S({name:"",email:"",phone:(null===a||void 0===a?void 0:a.phone)||"",address:"",city:"",province:"",zip:"",order_note:"",order_image_url:"",complete_now:!1});f(!0),Y(""),Promise.all([i.A.get("".concat(l,"/search-customer?phone_number=").concat(encodeURIComponent(a.phone))).catch((()=>null)),i.A.get("".concat(l,"/search-customers-all?phone_number=").concat(encodeURIComponent(a.phone))).catch((()=>({data:[]})))]).then((e=>{let[t,s]=e;const r=Array.isArray(null===s||void 0===s?void 0:s.data)?s.data:[];if(h(r),r.length>0){var d;const e=r[0];v(e.customer_id),b(0),p(e);const t=e.primary_address||(null===(d=e.addresses)||void 0===d?void 0:d[0])||{};S({name:e.name||"",email:e.email||"",phone:e.phone||a.phone,address:t.address1||"",city:t.city||"",province:t.province||"",zip:t.zip||"",order_note:"",order_image_url:"",complete_now:!1}),i.A.get("".concat(l,"/shopify-orders"),{params:{customer_id:e.customer_id,limit:50}}).then((e=>N(Array.isArray(e.data)?e.data:[]))).catch((()=>N([])))}else if(null!==t&&void 0!==t&&t.data){const e=t.data;p(e),S({name:e.name||"",email:e.email||"",phone:e.phone||a.phone,address:e.address||"",city:e.city||"",province:e.province||"",zip:e.zip||"",order_note:"",order_image_url:"",complete_now:!1}),e.customer_id?i.A.get("".concat(l,"/shopify-orders"),{params:{customer_id:e.customer_id,limit:50}}).then((e=>N(Array.isArray(e.data)?e.data:[]))).catch((()=>N([]))):N([])}else p(null),S((e=>(0,n.A)((0,n.A)({},e),{},{phone:a.phone||""}))),N([])})).catch((e=>{var t,a,n;const s=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.detail)||(null===e||void 0===e?void 0:e.message)||"";403===(null===e||void 0===e||null===(n=e.response)||void 0===n?void 0:n.status)?Y("Shopify permissions error: token lacks read_customers scope or app not installed."):s&&Y(String(s))})).finally((()=>f(!1)))}),[a,l]),(0,s.useEffect)((()=>{if(!z)return void P([]);const e=setTimeout((async()=>{try{const e=await i.A.get("".concat(l,"/shopify-products?q=").concat(encodeURIComponent(z)));P(e.data||[])}catch(e){P([])}}),500);return()=>clearTimeout(e)}),[z,l]);const se=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e)try{const a=await i.A.get("".concat(l,"/shopify-variant/").concat(e));a.data&&I((e=>[...e,{variant:a.data,quantity:Number(t)||1,discount:0}]))}catch(a){Y("Variant not found.")}},re=((0,s.useMemo)((()=>e=>{try{const t=(e||[]).reduce(((e,t)=>{var a;return e+Number((null===t||void 0===t||null===(a=t.variant)||void 0===a?void 0:a.price)||0)*Number((null===t||void 0===t?void 0:t.quantity)||1)-Number((null===t||void 0===t?void 0:t.discount)||0)}),0);return Math.max(0,Number(t.toFixed(2)))}catch(t){return 0}}),[]),(e,t,a)=>{I((s=>s.map(((s,r)=>r===e?(0,n.A)((0,n.A)({},s),{},{[t]:a}):s))))});(0,s.useEffect)((()=>{const e=e=>{const t=(null===e||void 0===e?void 0:e.detail)||{},a=t.variantId||t.productId||t.id,n=t.quantity||1;a&&se(String(a),Number(n)||1)};return window.addEventListener("add-to-order",e),()=>window.removeEventListener("add-to-order",e)}),[se]),(0,s.useEffect)((()=>{if(null===a||void 0===a||!a.user_id)return;let e=!0;return(0,d.Bb)(a.user_id).then((t=>{e&&I(Array.isArray(t)?t:[])})).catch((()=>I([]))),()=>{e=!1}}),[null===a||void 0===a?void 0:a.user_id]),(0,s.useEffect)((()=>{null!==a&&void 0!==a&&a.user_id&&(0,d.o2)(a.user_id,T).catch((()=>{}))}),[T,null===a||void 0===a?void 0:a.user_id]);const ie=async()=>{var e,t,s,r;if(Y(""),G(null),null===(e=C.address)||void 0===e||!e.trim()||null===(t=C.city)||void 0===t||!t.trim()||null===(s=C.province)||void 0===s||!s.trim()||null===(r=C.zip)||void 0===r||!r.trim())return void Y("Please fill all shipping address fields (address, city, province, zip)!");if(!T.length)return void Y("Please select at least one product/variant.");const c=(p=C.phone)?p.startsWith("+")?p:12===p.length&&p.startsWith("212")?"+"+p:10===p.length&&p.startsWith("06")?"+212"+p.slice(1):p:"";var p;const m=(0,n.A)((0,n.A)((0,n.A)({},C),{},{phone:c,items:T.map((e=>({variant_id:e.variant.id,title:e.variant.title,quantity:Number(e.quantity)||1,discount:Number(e.discount)||0}))),delivery:R,payment_term:U},null!==u&&void 0!==u&&u.customer_id?{customer_id:u.customer_id}:{}),{},{create_customer_if_missing:!!ae,market:H});B(!0);try{const e=await i.A.post("".concat(l,"/create-shopify-order"),m);I([]);try{null!==a&&void 0!==a&&a.user_id&&await(0,d.o2)(a.user_id,[])}catch(h){}Y(""),G((null===e||void 0===e?void 0:e.data)||null),alert("Order created successfully!"),await(async e=>{try{var t,n,s,r;if(null===a||void 0===a||!a.user_id)return;const d=((null===C||void 0===C?void 0:C.name)||"").trim(),[c="",u=""]=d.split(" ",2),p=(T||[]).length,m=(T||[]).reduce(((e,t)=>{var a;return e+Number((null===t||void 0===t||null===(a=t.variant)||void 0===a?void 0:a.price)||0)*Number((null===t||void 0===t?void 0:t.quantity)||1)}),0),h=(T||[]).reduce(((e,t)=>e+Number((null===t||void 0===t?void 0:t.discount)||0)),0),x=Math.max(0,Number((m-h).toFixed(2))),v=new Date,g=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648\u0632","\u063a\u0634\u062a","\u0634\u062a\u0646\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u062c\u0646\u0628\u0631"],b=String(v.getDate()).padStart(2,"0"),y=g[v.getMonth()];let f=v.getHours();const j=String(v.getMinutes()).padStart(2,"0"),N=f>=12?"\u0645":"\u0635";f%=12,0===f&&(f=12);const w="".concat(b," ").concat(y," ").concat(v.getFullYear(),"\u060c ").concat(String(f).padStart(2,"0"),":").concat(j," ").concat(N),_=(U||"").toLowerCase().includes("receipt")||(R||"").toLowerCase().includes("cod"),k="paid"===(U||"").toLowerCase(),A=_?"\u0627\u0644\u062f\u0641\u0639 \u0639\u0646\u062f \u0627\u0644\u062a\u0633\u0644\u064a\u0645":k?"\u0628\u0637\u0627\u0642\u0629/\u0645\u062d\u0641\u0638\u0629":"\u2014",S=(null!==e&&void 0!==e&&e.order_admin_link?e.order_admin_link.split("/").pop():"")||(null!==e&&void 0!==e&&e.draft_order_id?"Draft #".concat(e.draft_order_id):"Order ".concat((new Date).toISOString().slice(0,10))),z=(T||[])[0]||null,D=(null===z||void 0===z||null===(t=z.variant)||void 0===t?void 0:t.image_src)||"",M=(null===z||void 0===z||null===(n=z.variant)||void 0===n?void 0:n.product_title)||(null===z||void 0===z||null===(s=z.variant)||void 0===s?void 0:s.title)||"",P=(null===z||void 0===z||null===(r=z.variant)||void 0===r?void 0:r.title)||"",E=Number((null===z||void 0===z?void 0:z.quantity)||0),O=Math.max(0,p-1),I=(e=>{let{orderName:t,createdAtDisplay:a,isPaid:n,paymentMethod:s,subtotal:r,totalDiscount:i,total:d,currency:l,productImageUrl:o,productTitle:c,productVariantTitle:u,qty:p,moreCount:m,addressName:h,address1:x,address2:v,city:g,provinceCode:b,zip:y}=e;return'<!DOCTYPE html>\n<html lang="ar" dir="rtl">\n<head>\n  <meta charset="utf-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1" />\n  <title>\u0641\u0627\u062a\u0648\u0631\u0629 \u2014 '.concat(t,'</title>\n  <style>\n    :root{\n      --brand:#004AAD;             /* irrakids blue */\n      --accent:#6A7CFF;            /* secondary blue */\n      --ink:#e5e7eb;               /* text */\n      --muted:#9ca3af;             /* secondary text */\n      --card:#0f1722;              /* single-color card background */\n      --width: 320px;\n    }\n\n    *{box-sizing:border-box}\n    body{margin:0; padding:24px; background:transparent; font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--ink)}\n\n    .wrap{display:flex; justify-content:center}\n\n    .ticket{width:var(--width); position:relative; border-radius:20px; overflow:hidden; \n            background:var(--card);\n    }\n\n    /* Remove scallops/notches for WhatsApp-native look */\n\n    .inner{padding:18px 18px 16px; position:relative}\n\n    .emblem{display:flex; align-items:center; justify-content:center; margin:8px 0 10px}\n    .halo{width:52px; height:52px; border-radius:999px; background:radial-gradient(closest-side, rgba(0,74,173,.35), rgba(0,74,173,.08) 60%, transparent 65%);\n          display:grid; place-items:center;}\n    .check{width:34px; height:34px; border-radius:999px; background:linear-gradient(180deg, #3f82ff, var(--brand)); box-shadow:0 6px 14px rgba(0,74,173,.45) inset, 0 2px 10px rgba(0,0,0,.25); display:grid; place-items:center}\n    .check svg{width:18px; height:18px; color:white}\n\n    h1{margin:6px 0 6px; text-align:center; font-size:18px; letter-spacing:.2px; font-weight:800}\n\n    .rule{height:1px; background:repeating-linear-gradient(90deg, rgba(255,255,255,.16) 0 7px, transparent 7px 14px); margin:10px 0}\n\n    .kv{display:flex; justify-content:space-between; gap:10px; padding:6px 0; align-items:center}\n    .kv .k{color:var(--muted)}\n    .kv .v{color:var(--ink); font-weight:700; text-align:left}\n\n    .summary{margin-top:4px}\n    .row{display:flex; justify-content:space-between; padding:6px 0}\n    .row.sub, .row.dis{color:var(--muted)}\n\n    .total{display:flex; justify-content:space-between; align-items:center; margin-top:10px; padding:10px 12px; border-radius:14px;\n           background:linear-gradient(145deg, rgba(255,255,255,.06), rgba(255,255,255,.04)); font-weight:900; font-size:16px;}\n\n    /* Product + Address blocks */\n    .section-title{font-weight:800; font-size:12px; letter-spacing:.6px; text-transform:uppercase; color:var(--accent); margin:6px 0 6px}\n\n    .product{display:flex; gap:10px; align-items:flex-start; padding:6px 0}\n    .thumb{width:60px; height:60px; border-radius:10px; overflow:hidden; flex:0 0 auto; box-shadow:0 4px 10px rgba(0,0,0,.25)}\n    .thumb img{width:100%; height:100%; object-fit:cover; display:block}\n    .prod-info{flex:1}\n    .prod-title{font-weight:700; font-size:13px}\n    .prod-variant{color:var(--muted); font-size:12px; margin-top:2px}\n    .chips{margin-top:6px; display:flex; gap:6px; flex-wrap:wrap}\n    .chip{font-size:11px; font-weight:800; color:#fff; background:linear-gradient(180deg, #6f85ff, var(--accent)); padding:2px 8px; border-radius:999px}\n\n    .address{padding:6px 0}\n    .addr-name{font-weight:700; font-size:13px}\n    .addr-lines{color:var(--muted); font-size:12px; line-height:1.35; margin-top:2px}\n\n    .foot{padding:10px 0 4px; text-align:center; color:var(--muted); font-size:11px}\n\n    .no-print{text-align:center; margin-top:10px}\n    .btn{padding:8px 12px; border-radius:10px; border:0; background:#1f6feb; color:#fff; font-weight:700; cursor:pointer}\n\n    @media print{\n      body{background:none; padding:0}\n      .ticket{box-shadow:none}\n      .no-print{display:none !important}\n    }\n  </style>\n</head>\n<body>\n  <div class="wrap">\n    <div class="ticket" role="document" aria-label="Payment Ticket">\n      <div class="inner">\n        <div class="emblem">\n          <div class="halo">\n            <div class="check" aria-hidden="true">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">\n                <path d="M20 6L9 17l-5-5"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n        <h1>\n          ').concat(n?"\u062a\u0645 \u0627\u0644\u062f\u0641\u0639 \u0628\u0646\u062c\u0627\u062d":"\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0637\u0644\u0628",'\n        </h1>\n\n        <div class="rule" aria-hidden="true"></div>\n\n        \x3c!-- Product (first item) --\x3e\n        <div class="section-title">\u0627\u0644\u0645\u0646\u062a\u062c</div>\n        <div class="product">\n          <div class="thumb">\n            ').concat(o?'<img src="'.concat(o,'" crossorigin="anonymous" alt="').concat(c||"Item",'" />'):'<img src="https://cdn.shopify.com/s/images/admin/no-image-compact-1.gif" alt="No image" />','\n          </div>\n          <div class="prod-info">\n            <div class="prod-title">').concat(c||"","</div>\n            ").concat(u?'<div class="prod-variant">'.concat(u,"</div>"):"",'\n            <div class="chips">\n              <span class="chip">\u0627\u0644\u0643\u0645\u064a\u0629 \xd7').concat(p,"</span>\n              ").concat(m>0?'<span class="chip">+'.concat(m," \u0625\u0636\u0627\u0641\u064a</span>"):"",'\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Address --\x3e\n        <div class="section-title">\u0627\u0644\u0639\u0645\u064a\u0644</div>\n        <div class="address">\n          <div class="addr-name">').concat(h,'</div>\n          <div class="addr-lines">\n            ').concat(x||"").concat(v?", ".concat(v):"","<br/>\n            ").concat(g||"").concat(b?", ".concat(b):"").concat(y?" ".concat(y):"",'\n          </div>\n        </div>\n\n        <div class="rule" aria-hidden="true"></div>\n\n        <div class="kv"><span class="k">\u0631\u0642\u0645 \u0627\u0644\u0645\u0631\u062c\u0639</span><span class="v">').concat(t,'</span></div>\n        <div class="kv"><span class="k">\u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0648\u0627\u0644\u0648\u0642\u062a</span><span class="v">').concat(a,'</span></div>\n        <div class="kv"><span class="k">\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639</span>\n          <span class="v">').concat(s,'</span>\n        </div>\n\n        <div class="rule" aria-hidden="true"></div>\n\n        <div class="rule" aria-hidden="true"></div>\n\n        <div class="summary">\n          <div class="row sub"><span>\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a</span><span>').concat(r," ").concat(l,"</span></div>\n          ").concat(i>0?'<div class="row dis"><span>\u0627\u0644\u062e\u0635\u0645</span><span>-'.concat(i," ").concat(l,"</span></div>"):"","\n          ").concat(i>0?'<div class="rule" aria-hidden="true"></div>':"",'\n          <div class="total"><span>\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a</span><span style="font-size:18px">').concat(d," ").concat(l,'</span></div>\n        </div>\n\n        <div class="foot">\u0634\u0643\u0631\u064b\u0627 \u0644\u062a\u0633\u0648\u0642\u0643 \u0645\u0639\u0646\u0627</div>\n      </div>\n    </div>\n  </div>\n\n  <div class="no-print"><button class="btn" onclick="window.print()">Print</button></div>\n</body>\n</html>')})({orderName:S,createdAtDisplay:w,isPaid:k,paymentMethod:A,subtotal:Number(m.toFixed(2)),totalDiscount:Number(h.toFixed(2)),total:x,currency:"MAD",productImageUrl:D,productTitle:M,productVariantTitle:P,qty:E,moreCount:O,addressName:d||"",address1:(null===C||void 0===C?void 0:C.address)||"",address2:"",city:(null===C||void 0===C?void 0:C.city)||"",provinceCode:(null===C||void 0===C?void 0:C.province)||"",zip:(null===C||void 0===C?void 0:C.zip)||""}),q=document.createElement("div");q.style.position="fixed",q.style.left="-10000px",q.style.top="0",q.style.zIndex="-1",q.innerHTML=I,document.body.appendChild(q);const F=q.querySelector(".ticket")||q,L=await o()(F,{scale:2,backgroundColor:null,useCORS:!0}),W=await new Promise((e=>L.toBlob(e,"image/png",1)));if(!W)return void document.body.removeChild(q);const H=new File([W],"order_label_".concat(Date.now(),".png"),{type:"image/png"}),V=new FormData;V.append("user_id",a.user_id),V.append("media_type","image"),V.append("files",H,H.name);const B=["\u0647\u0630\u0647 \u0641\u0627\u062a\u0648\u0631\u062a\u0643 \ud83d\udcc4","\u062a\u0645 \u062a\u0623\u0643\u064a\u062f \u0637\u0644\u0628\u0643: ".concat(S),"\u064a\u0631\u062c\u0649 \u0645\u0631\u0627\u062c\u0639\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0628\u0639\u0646\u0627\u064a\u0629: \u0639\u0646\u0648\u0627\u0646\u0643 \u0648\u0631\u0642\u0645 \u0647\u0627\u062a\u0641\u0643 \u0648\u0627\u0644\u0645\u0646\u062a\u062c\u0627\u062a \u0648\u0627\u0644\u0645\u0642\u0627\u0633 \u0648\u0627\u0644\u0644\u0648\u0646 \u062d\u062a\u0649 \u064a\u0635\u0644\u0643 \u0637\u0644\u0628\u0643 \u0628\u0633\u0631\u0639\u0629 \u0648\u0628\u062f\u0648\u0646 \u0623\u064a \u0645\u0634\u0627\u0643\u0644.","\u0634\u0643\u0631\u0627\u064b \u0644\u062a\u0633\u0648\u0642\u0643 \u0645\u0639\u0646\u0627 \u2764\ufe0f"].join("\n");V.append("caption",B),await i.A.post("".concat(l,"/send-media"),V,{headers:{"Content-Type":"multipart/form-data"}}),document.body.removeChild(q)}catch(d){}})(null===e||void 0===e?void 0:e.data)}catch(x){Y("Error creating order.")}finally{B(!1)}},de=(e,t)=>{S((a=>(0,n.A)((0,n.A)({},a),{},{[e]:t})))};return(0,c.jsxs)("div",{className:"p-4 h-full flex flex-col",children:[(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("button",{className:"w-full flex justify-between items-center bg-gray-800 px-4 py-2 rounded-t text-lg font-bold",onClick:()=>_((e=>!e)),children:[(0,c.jsxs)("span",{className:"flex items-center",children:[(0,c.jsx)(r.M2,{className:"mr-2 text-green-400"}),"Contact Information"]}),(0,c.jsx)("span",{children:w?"\u25b2":"\u25bc"})]}),w&&(0,c.jsxs)("div",{className:"bg-gray-700 p-4 space-y-2 rounded-b shadow-inner",children:[!(null!==a&&void 0!==a&&a.phone)&&(0,c.jsx)("p",{children:"Select a conversation with a user to fetch Shopify customer info by phone."}),(null===a||void 0===a?void 0:a.phone)&&y&&(0,c.jsxs)("div",{className:"space-y-2","aria-live":"polite",children:[(0,c.jsx)("div",{className:"h-4 bg-gray-600 rounded animate-pulse"}),(0,c.jsx)("div",{className:"h-4 bg-gray-600 rounded animate-pulse w-2/3"}),(0,c.jsx)("div",{className:"h-4 bg-gray-600 rounded animate-pulse w-1/2"})]}),(null===a||void 0===a?void 0:a.phone)&&!y&&(u||m.length>0)&&(0,c.jsxs)(c.Fragment,{children:[m.length>0?(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)("div",{className:"text-sm text-gray-300",children:"Select customer for this phone:"}),(0,c.jsx)("select",{className:"w-full bg-gray-800 text-white p-2 rounded",value:x||"",onChange:e=>{var t;const s=e.target.value,r=m.find((e=>String(e.customer_id)===String(s)));if(!r)return;v(r.customer_id),b(0),p(r);const d=r.primary_address||(null===(t=r.addresses)||void 0===t?void 0:t[0])||{};S((e=>(0,n.A)((0,n.A)({},e),{},{name:r.name||"",email:r.email||"",phone:r.phone||a.phone,address:d.address1||"",city:d.city||"",province:d.province||"",zip:d.zip||""}))),i.A.get("".concat(l,"/shopify-orders"),{params:{customer_id:r.customer_id,limit:50}}).then((e=>N(Array.isArray(e.data)?e.data:[]))).catch((()=>N([])))},children:m.map((e=>(0,c.jsxs)("option",{value:e.customer_id,children:[e.name||"(no name)"," \u2022 ",e.phone||""]},e.customer_id)))}),Array.isArray(null===u||void 0===u?void 0:u.addresses)&&u.addresses.length>0&&(0,c.jsxs)("details",{children:[(0,c.jsxs)("summary",{className:"cursor-pointer text-xs text-gray-300",children:["Addresses (",u.addresses.length,")"]}),(0,c.jsxs)("div",{className:"mt-1",children:[(0,c.jsx)("div",{className:"text-xs mb-1",children:"Select address:"}),(0,c.jsx)("select",{className:"bg-gray-800 text-white p-1 rounded",value:g,onChange:e=>{const t=Number(e.target.value)||0;b(t);const a=u.addresses[t]||{};S((e=>(0,n.A)((0,n.A)({},e),{},{address:a.address1||"",city:a.city||"",province:a.province||"",zip:a.zip||""})))},children:u.addresses.map(((e,t)=>(0,c.jsxs)("option",{value:t,children:[e.address1||""," ",e.city?", ".concat(e.city):""]},t)))})]})]})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Name:"})," ",u.name]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Email:"})," ",u.email]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Phone:"})," ",u.phone]}),Array.isArray(u.addresses)&&u.addresses.length>0?(0,c.jsxs)("details",{children:[(0,c.jsxs)("summary",{className:"cursor-pointer",children:["Addresses (",u.addresses.length,")"]}),(0,c.jsxs)("div",{className:"ml-4 mt-1",children:[(0,c.jsx)("div",{className:"text-xs mb-1",children:"Select address:"}),(0,c.jsx)("select",{className:"bg-gray-800 text-white p-1 rounded",value:g,onChange:e=>{const t=Number(e.target.value)||0;b(t);const a=u.addresses[t]||{};S((e=>(0,n.A)((0,n.A)({},e),{},{address:a.address1||"",city:a.city||"",province:a.province||"",zip:a.zip||""})))},children:u.addresses.map(((e,t)=>(0,c.jsxs)("option",{value:t,children:[e.address1||""," ",e.city?", ".concat(e.city):""]},t)))})]})]}):(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Address:"})," ",u.address]})]}),(0,c.jsx)("hr",{className:"my-2"}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Total Orders:"})," ",null===(t=u||m[0])||void 0===t?void 0:t.total_orders]}),Array.isArray(j)&&j.length>0&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("div",{className:"font-semibold mb-1",children:"Orders"}),(0,c.jsx)("ul",{className:"space-y-1 max-h-40 overflow-auto pr-1",children:j.map((e=>(0,c.jsxs)("li",{className:"text-sm flex justify-between gap-2 border-b border-gray-600 py-1",children:[(0,c.jsxs)("div",{className:"min-w-0",children:[(0,c.jsx)("a",{href:e.admin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-300 hover:underline truncate inline-block",title:"Open in Shopify admin",children:e.order_number}),(0,c.jsxs)("div",{className:"text-xs text-gray-300",children:[new Date(e.created_at).toLocaleString()," \u2022 ",e.financial_status||"unpaid",e.fulfillment_status?" \u2022 ".concat(e.fulfillment_status):""]})]}),(0,c.jsxs)("div",{className:"text-right text-sm whitespace-nowrap",children:[e.total_price," ",e.currency||""]})]},e.id)))})]}),u.address&&(0,c.jsx)("button",{className:"mt-2 bg-blue-500 hover:bg-blue-700 text-white text-xs px-2 py-1 rounded",onClick:()=>{navigator.clipboard.writeText(u.address+(u.city?", ".concat(u.city):"")),alert("Address copied to clipboard!")},children:"Copy address"})]}),(null===a||void 0===a?void 0:a.phone)&&!y&&!u&&(0,c.jsxs)(c.Fragment,{children:[K?(0,c.jsx)("p",{className:"text-yellow-300",children:K}):(0,c.jsx)("p",{className:"text-red-400",children:"No customer found."}),(0,c.jsxs)("div",{className:"mt-2 p-2 bg-gray-800 rounded",children:[(0,c.jsx)("div",{className:"text-xs text-gray-300 mb-1",children:"Search customers by phone or email (different from WhatsApp):"}),(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)("input",{className:"flex-1 p-1 rounded bg-gray-900 text-white",placeholder:"Enter phone or email",value:Q,onChange:e=>J(e.target.value)}),(0,c.jsx)("button",{className:"px-2 py-1 bg-blue-600 rounded text-white",onClick:async()=>{if(Q.trim()){te(!0),$([]);try{const e=await i.A.get("".concat(l,"/search-customers-all?phone_number=").concat(encodeURIComponent(Q.trim()))),t=Array.isArray(e.data)?e.data:[];$(t)}catch(e){$([])}finally{te(!1)}}},type:"button",children:"Search"})]}),ee&&(0,c.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"Searching\u2026"}),X.length>0&&(0,c.jsx)("ul",{className:"mt-2 space-y-1 max-h-40 overflow-auto pr-1",children:X.map((e=>(0,c.jsxs)("li",{className:"flex justify-between items-center gap-2 bg-gray-900 p-2 rounded",children:[(0,c.jsxs)("div",{className:"min-w-0",children:[(0,c.jsx)("div",{className:"font-semibold text-sm truncate",children:e.name||"(no name)"}),(0,c.jsx)("div",{className:"text-xs text-gray-300 truncate",children:e.phone||e.email||""})]}),(0,c.jsx)("button",{className:"px-2 py-1 bg-green-600 rounded text-white text-xs whitespace-nowrap",type:"button",onClick:()=>{var t;p(e),v(e.customer_id),b(0);const a=e.primary_address||(null===(t=e.addresses)||void 0===t?void 0:t[0])||{};S((t=>(0,n.A)((0,n.A)({},t),{},{name:e.name||"",email:e.email||"",phone:e.phone||C.phone,address:a.address1||"",city:a.city||"",province:a.province||"",zip:a.zip||""}))),$([]),J(""),i.A.get("".concat(l,"/shopify-orders"),{params:{customer_id:e.customer_id,limit:50}}).then((e=>N(Array.isArray(e.data)?e.data:[]))).catch((()=>N([])))},children:"Select"})]},e.customer_id)))})]})]})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("button",{className:"w-full flex justify-between items-center bg-gray-800 px-4 py-2 rounded-t text-lg font-bold",onClick:()=>A((e=>!e)),children:[(0,c.jsx)("span",{children:"Create an Order"}),(0,c.jsx)("span",{children:k?"\u25b2":"\u25bc"})]}),k&&(0,c.jsxs)("form",{className:"bg-gray-700 p-4 rounded-b shadow-inner space-y-2",onSubmit:e=>{e.preventDefault(),ie()},autoComplete:"off",children:[K&&(0,c.jsx)("div",{className:"bg-red-500 text-white px-2 py-1 rounded mb-2",children:K}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"block text-xs font-bold",children:"Name"}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.name,onChange:e=>de("name",e.target.value),autoComplete:"off",placeholder:"Customer name",title:"Customer full name"}),(0,c.jsx)("label",{className:"block text-xs font-bold",children:"Email"}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.email,onChange:e=>de("email",e.target.value),autoComplete:"off",placeholder:"customer@example.com",title:"Customer email (optional)"}),(0,c.jsx)("label",{className:"block text-xs font-bold",children:"Phone"}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.phone,onChange:e=>de("phone",e.target.value),autoComplete:"off",placeholder:"+212...",title:"Customer phone number"}),(0,c.jsxs)("label",{className:"block text-xs font-bold",children:["City ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.city,onChange:e=>de("city",e.target.value),autoComplete:"off",required:!0,placeholder:"City",title:"Shipping city"}),(0,c.jsxs)("label",{className:"block text-xs font-bold",children:["Province ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsxs)("select",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.province,onChange:e=>de("province",e.target.value),required:!0,title:"Province/Region",children:[(0,c.jsx)("option",{value:"",disabled:!0,children:"Select province"}),["Marrakech-Safi","Casablanca-Settat","Rabat-Sal\xe9-K\xe9nitra","F\xe8s-Mekn\xe8s","Tanger-T\xe9touan-Al Hoce\xefma","Dr\xe2a-Tafilalet","Souss-Massa","Beni Mellal-Kh\xe9nifra","Oriental","Guelmim-Oued Noun","La\xe2youne-Sakia El Hamra","Dakhla-Oued Ed-Dahab"].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]}),(0,c.jsxs)("label",{className:"block text-xs font-bold",children:["ZIP ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.zip,onChange:e=>de("zip",e.target.value),autoComplete:"off",required:!0,placeholder:"Postal code",title:"Postal/ZIP code"}),(0,c.jsxs)("label",{className:"block text-xs font-bold",children:["Address ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",value:C.address,onChange:e=>de("address",e.target.value),autoComplete:"off",required:!0,placeholder:"Street address",title:"Shipping street address"}),(0,c.jsxs)("details",{className:"mt-2",children:[(0,c.jsx)("summary",{className:"cursor-pointer text-xs text-gray-300",children:"Additional details"}),(0,c.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,c.jsx)("label",{className:"block text-xs font-bold",children:"Order note (timeline text)"}),(0,c.jsx)("textarea",{className:"w-full p-1 rounded bg-gray-800 text-white",rows:3,placeholder:"e.g. Customer requested gift wrap.",value:C.order_note,onChange:e=>de("order_note",e.target.value)}),(0,c.jsx)("label",{className:"block text-xs font-bold",children:"Image URL (will be saved in note)"}),(0,c.jsx)("input",{className:"w-full p-1 rounded bg-gray-800 text-white",placeholder:"https://...",value:C.order_image_url,onChange:e=>de("order_image_url",e.target.value),autoComplete:"off",title:"Optional image URL for order note"}),C.order_image_url&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("div",{className:"text-xs text-gray-300 mb-1",children:"Preview:"}),(0,c.jsx)("img",{src:C.order_image_url,alt:"Order reference",className:"w-24 h-24 object-cover rounded border border-gray-600 bg-gray-900",onError:e=>{e.currentTarget.style.display="none"},loading:"lazy"})]})]})]})]}),(0,c.jsx)("hr",{className:"my-2"}),(0,c.jsx)("h3",{className:"font-bold text-lg mb-2",children:"Add products"}),(0,c.jsx)("input",{value:z,onChange:e=>D(e.target.value),placeholder:"Search products\u2026",className:"p-1 rounded bg-gray-800 text-white w-full"}),M.map((e=>(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{children:e.title}),(0,c.jsx)("div",{children:e.variants.map((e=>(0,c.jsxs)("button",{type:"button",className:"border p-1 m-1 rounded",onClick:()=>(e=>{I((t=>[...t,{variant:e,quantity:1,discount:0}]))})(e),children:[e.title," \u2022 ",e.price," MAD"]},e.id)))})]},e.id))),(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("input",{value:E,onChange:e=>O(e.target.value),placeholder:"Add by Variant ID",className:"p-1 rounded bg-gray-800 text-white"}),(0,c.jsx)("button",{type:"button",className:"bg-blue-600 text-white rounded px-2 py-1 ml-2",onClick:async()=>{E&&(await se(E,1),O(""))},children:"Add Variant"})]}),(0,c.jsxs)("table",{className:"w-full text-xs mt-2",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"text-left",children:"Item"}),(0,c.jsx)("th",{children:"Variant"}),(0,c.jsx)("th",{children:"Price"}),(0,c.jsx)("th",{children:"Qty"}),(0,c.jsx)("th",{children:"Discount"}),(0,c.jsx)("th",{children:"Subtotal"}),(0,c.jsx)("th",{children:"Remove"})]})}),(0,c.jsx)("tbody",{children:T.map(((e,t)=>{const a=e.variant.image_src,n=Number(e.variant.price||0),s=Number(e.quantity||1),r=Number(e.discount||0),i=Math.max(0,n*s-r);return(0,c.jsxs)("tr",{className:"align-middle",children:[(0,c.jsx)("td",{children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,c.jsx)("img",{src:a,alt:e.variant.title,className:"w-10 h-10 object-cover rounded"}):(0,c.jsx)("div",{className:"w-10 h-10 rounded bg-gray-600 flex items-center justify-center",children:"\ud83d\uded2"}),(0,c.jsx)("div",{className:"min-w-0",children:(0,c.jsx)("div",{className:"font-semibold truncate max-w-[140px]",children:e.variant.product_title||"--"})})]})}),(0,c.jsx)("td",{children:e.variant.title}),(0,c.jsxs)("td",{className:"text-center",children:[n," MAD"]}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:e=>re(t,"quantity",Number(e.target.value)),className:"w-12 bg-gray-800 text-white p-1"})}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{type:"number",min:"0",value:e.discount,onChange:e=>re(t,"discount",Number(e.target.value)),className:"w-12 bg-gray-800 text-white p-1",placeholder:"MAD"})}),(0,c.jsxs)("td",{className:"text-center font-semibold",children:[i," MAD"]}),(0,c.jsx)("td",{children:(0,c.jsx)("button",{type:"button",className:"text-red-400",onClick:()=>(e=>{I((t=>t.filter(((t,a)=>a!==e))))})(t),children:"\u2716"})})]},e.variant.id)}))})]}),T.length>0&&(0,c.jsx)("div",{className:"mt-2 text-right font-bold text-sm",children:(()=>{const e=T.reduce(((e,t)=>{const a=Number(t.variant.price||0),n=Number(t.quantity||1),s=Number(t.discount||0);return e+Math.max(0,a*n-s)}),0);return(0,c.jsxs)("span",{children:["Total: ",e," MAD"]})})()}),(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("label",{className:"block font-bold text-xs mb-1",children:"Delivery"}),(0,c.jsx)("select",{className:"bg-gray-800 text-white px-2 py-1 rounded",value:R,onChange:e=>L(e.target.value),children:q.map((e=>(0,c.jsxs)("option",{value:e.name,children:[e.name," ",e.zone?"(".concat(e.zone,")"):""]},e.id)))})]}),(0,c.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,c.jsx)("input",{id:"paymentDueLater",type:"checkbox",checked:"due_on_receipt"===U,onChange:e=>W(e.target.checked?"due_on_receipt":"paid"),className:"mr-2"}),(0,c.jsx)("label",{htmlFor:"paymentDueLater",className:"font-bold text-xs",children:"Payment due later"})]}),(0,c.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,c.jsx)("input",{id:"completeNow",type:"checkbox",checked:C.complete_now,onChange:e=>de("complete_now",e.target.checked),className:"mr-2"}),(0,c.jsx)("label",{htmlFor:"completeNow",className:"font-bold text-xs",children:"Complete draft now (creates order as payment pending)"})]}),(0,c.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,c.jsx)("input",{id:"createCustomerIfMissing",type:"checkbox",checked:ae,onChange:e=>ne(e.target.checked),className:"mr-2"}),(0,c.jsx)("label",{htmlFor:"createCustomerIfMissing",className:"font-bold text-xs",children:"Create Shopify customer if none found"})]}),(0,c.jsx)("div",{className:"mt-2 text-xs text-gray-400",children:(0,c.jsx)("span",{children:"Market: Moroccan default (auto)"})}),(0,c.jsx)("button",{className:"w-full px-4 py-2 rounded mt-4 font-bold ".concat(V?"bg-gray-400":"bg-green-600"),type:"submit",disabled:V,children:V?"Creating...":"Create Shopify Order"}),Z&&(0,c.jsxs)("div",{className:"mt-3 text-xs bg-gray-800 p-2 rounded",children:[(0,c.jsx)("div",{className:"font-bold",children:"Result"}),Z.shopify_admin_link&&(0,c.jsxs)("div",{children:["Draft: ",(0,c.jsx)("a",{className:"text-blue-300 underline",href:Z.shopify_admin_link,target:"_blank",rel:"noreferrer",children:"Open draft"})]}),Z.order_admin_link&&(0,c.jsxs)("div",{children:["Order: ",(0,c.jsx)("a",{className:"text-blue-300 underline",href:Z.order_admin_link,target:"_blank",rel:"noreferrer",children:"Open order"})]}),Z.message&&(0,c.jsx)("div",{className:"text-gray-300 mt-1",children:Z.message})]})]})]})]})}}}]);
//# sourceMappingURL=111.51dcdc87.chunk.js.map